<div class="container">
    <!-- Sidebar Menu -->
    <div class="sidebar" (mouseover)="openMenu()" (mouseleave)="closeMenu()" [class.expanded]="isMenu">
      <!-- Logo -->
      <div class="logo" *ngIf="isMenu">
        METRONIC
        <span class="collapse-icon">¬´</span>
      </div>
      <div class="menu" *ngIf="isMenu" style="color: #fff;">
        <h6>CH·ª®C NƒÇNG</h6>
      </div>
      <ul>
        <li class="has-dropdown">
          <details *ngIf="isMenu">
            <summary >ChƒÉm s√≥c kh√°ch h√†ng</summary>
            <ul class="drop-menu" >
              <li><a routerLink="/admin/contact">Qu·∫£n l√Ω y√™u c·∫ßu</a></li>
              <li><a routerLink="/admin/customer">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</a></li>
            </ul>
          </details>
        </li>
        <li class="has-dropdown" *ngIf="isAdmin">
          <details *ngIf="isMenu">
            <summary >Qu·∫£n l√Ω ƒë∆°n h√†ng</summary>
            <ul class="drop-menu" >
              <li><a routerLink="/admin/orderprocessing">Qu·∫£n l√Ω ƒë∆°n h√†ng ƒë∆∞·ª£c duy·ªát</a></li>
              <li><a routerLink="/admin/order">Qu·∫£n l√Ω ƒë∆°n h√†ng</a></li>
            </ul>
          </details>
        </li>
        <li class="has-dropdown">
          <details *ngIf="isMenu">
            <summary >S·∫£n Ph·∫©m</summary>
            <ul class="drop-menu" >
              <li><a routerLink="/admin/product">Qu·∫£n l√Ω s·∫£n ph·∫©m</a></li>
              <li><a routerLink="/admin/category">Qu·∫£n l√Ω danh m·ª•c</a></li>
              <li><a routerLink="/admin/image">Qu·∫£n l√Ω h√¨nh ·∫£nh</a></li>
            </ul>
          </details>
        </li>
        <li class="has-dropdown" *ngIf="isAdmin">
          <details *ngIf="isMenu">
            <summary >B·ªô s∆∞u t·∫≠p </summary>
            <ul class="drop-menu" >
              <li><a routerLink="/admin/blog">Danh s√°ch Blog</a></li>
            </ul>
          </details>
        </li>
        <li class="has-dropdown" *ngIf="isAdmin">
          <details *ngIf="isMenu">
            <summary >B√¨nh lu·∫≠n</summary>
            <ul class="drop-menu" >
              <li><a routerLink="/admin/comment">Danh s√°ch b√¨nh lu·∫≠n</a></li>
            </ul>
          </details>
        </li>
        <li class="has-dropdown" *ngIf="isAdmin">
          <details *ngIf="isMenu">
            <summary >Ph√¢n quy·ªÅn </summary>
            <ul class="drop-menu" >
              <li><a routerLink="/admin/user">Nh√¢n s·ª±</a></li>
              <li><a routerLink="/admin/nhomquyen">Nh√≥m quy·ªÅn</a></li>
              <li><a routerLink="/admin/role">Quy·ªÅn</a></li>
            </ul>
          </details>
        </li>
        <li class="has-dropdown">
          <details *ngIf="isMenu">
            <summary >G·ª≠i th√¥ng b√°o t·ª± ƒë·ªông </summary>
            <ul class="drop-menu" >
              <li><a routerLink="">Th√¥ng b√°o t·ª± ƒë·ªông</a></li>
            </ul>
          </details>
        </li>
        <li class="has-dropdown">
          <details *ngIf="isMenu">
            <summary >L·ªãch s·ª≠</summary>
            <ul class="drop-menu" >
              <li><a routerLink="/admin/history">Th√¥ng tin l·ªãch s·ª≠ h·ªá th·ªëng</a></li>
            </ul>
          </details>
        </li>
        <li *ngIf="isMenu"><button class="update-btn" (click)="logout()">ƒêƒÉng xu·∫•t</button></li>
      </ul>
    </div>
  
    <!-- N·ªôi dung ch√≠nh -->
    <div class="main-content">
        <div class="order-list">

          <div class="header">
            <div class="header-content">
              <h2>Danh s√°ch ƒë∆°n h√†ng <span routerLink="/admin/home" class="sub-header">Trang ch·ªß</span></h2>
            </div>
            <div class="order-management">
              <h5>T·ªïng: {{totalOrder}} <span class="approved">S·ªë ƒë∆°n h√†ng ch·ªù x·ª≠ l√Ω: {{pendingOrders}}</span> <span class="pending">S·ªë ƒë∆°n h√†ng ƒë√£ giao: {{deliveredOrders}}</span>
              </h5>
            </div>
          </div>

          <table *ngIf="order.length > 0; else noOrders" class="table">
          <thead>
              <tr>
              <th>M√£ Ho√°n ƒë∆°n</th>
              <th>M√£ s·∫£n ph·∫©m </th>
              <th>T√™n kh√°ch h√†ng</th>
              <th>ƒê·ªãa ch·ªâ</th>
              <th>S·ªë ƒëi·ªán tho·∫°i</th>
              <th>T·ªïng ti·ªÅn</th>
              <th>Tr·∫°ng th√°i</th>
              <th>Ng√†y t·∫°o</th>
              <th>Action</th>
              </tr>
          </thead>
          <tbody>
              <tr *ngFor="let order of order">
              <td>{{ order.Id }}</td>
              <td >
                <ul>
                  <li *ngFor="let orderitem of order.OrderItems">{{ orderitem.ProductPosCode }}</li>
                </ul>
              </td>
              <td>{{ order.CustomerName }}</td>
              <td>{{ order.Address }}</td>
              <td>{{ order.Phone }}</td>
              <td>{{ order.TotalAmount | number}} VND</td>
              <td>{{ order.Status }}</td>
              <td>{{ order.CreatedAt | date:'dd/MM/yyyy HH:mm:ss' }}</td>
              <td class="btn-action" style="display: flex; gap: 1rem;">
                  <Button (click)="GetOrderDetail(order.Id)" class="button-detail">Xem chi ti·∫øt</Button>
                  <Button (click)="DeleteOrder(order.Id)" class="button-detail">X√≥a</Button>
              </td>
              </tr>
          </tbody>
          </table>
        </div>
        <!-- PH√ÇN TRANG -->
        <div class="pagination" style="display: flex; padding: 1rem; justify-content: center; gap: 6px; flex-wrap: wrap;">
          <!-- Trang ƒë·∫ßu v√† tr∆∞·ªõc -->
          <button (click)="prevPage()" [disabled]="page === 1">‚Äπ</button>
      
          <!-- Danh s√°ch s·ªë trang -->
          <button 
          *ngFor="let p of visiblePages"
          [class.active]="page === p"
          (click)="goToPage(p)">
          {{ p }}
          </button>
      
          <!-- Trang sau v√† cu·ªëi -->
          <button (click)="nextPage()" [disabled]="page === totalPages">‚Ä∫</button>
        </div>
        <ng-template #noOrders>
        <p>Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o.</p>
        </ng-template>
        <div class="overlay" *ngIf="isOrderDeatail"></div>
        <!-- CHI TI·∫æT ƒê∆†N H√ÄNG -->
        <div class="order-details" *ngIf="isOrderDeatail">
          <div class="order-details-header"> 
            <h5>Th√¥ng tin ƒë∆°n h√†ng </h5>
            <button class="btn-close-header" (click)="closedetail()">x</button>
          </div>
          <hr>
          <div class="order-details-main" *ngFor="let order of orderdetail">
            <div class="customer-infor">
              <dl>
                <dt>T√™n ng∆∞·ªùi mua</dt>
                <dd>{{order.CustomerName}}</dd>
                <dt>Email</dt>
                <dd>{{order.Email}}</dd>
                <dt>T·ªânh / Th√†nh Ph·ªë</dt>
                <dd>{{order.Province}}</dd>
                <dt>Qu·∫≠n / Huy·ªán </dt>
                <dd>{{order.District}}</dd>
                <dt>Ph∆∞·ªùng / X√£ </dt>
                <dd>{{order.Wards}}</dd>
                <dt>ƒê·ªãa ch·ªâ</dt>
                <dd>{{order.Address}}</dd>
                <dt>S·ªë ƒëi·ªán tho·∫°i</dt>
                <dd>{{order.Phone}}</dd>
                <dt>Ghi ch√∫</dt>
                <dd>{{order.Note}}</dd>
                <dt>Ng√†y mua</dt>
                <dd>{{order.CreatedAt | date:'dd/MM/yyyy HH:mm:ss'}}</dd>
              </dl>
            </div>
            <div class="order-items">
              <table>
                <thead>
                  <tr>
                    <th>T√™n s·∫£n ph·∫©m</th>
                    <th>M√£ PosCode </th>
                    <th>S·ªë l∆∞·ª£ng</th>
                    <th>K√≠ch th∆∞·ªõc</th>
                    <th>M√†u s·∫Øc</th>
                    <th>Gi√°</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let orderiteam of order.OrderItems">
                    <td>{{orderiteam.ProductName}}</td>
                    <td>{{orderiteam.ProductPosCode}}</td>
                    <td>{{orderiteam.Quantity}}</td>
                    <td>{{orderiteam.SizeName}}</td>
                    <td>{{orderiteam.ColorName}}</td>
                    <td>{{orderiteam.UnitPrice | number}}VND</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!--thanh toan-->
            <div class="payment-totals" style="margin-top: 2rem;">
              <dl>
                <dt>Gi·∫£m gi√°: </dt>
                <dd > -{{ getTotalDiscountForDetail() | number}} VND</dd>
                <dt>T·ªïng ti·ªÅn ƒë∆°n h√†ng: </dt>
                <dd >{{ order.TotalAmount | number}} VND</dd>
              </dl>
            </div>
            <!-- C·∫≠p nh·∫≠t tr·∫°ng th√°i -->
            <div class="status-update">
              <h6>Tr·∫°ng th√°i ƒë∆°n h√†ng: {{order.Status}}</h6>
              <div class="form-group">
                <label for="orderStatus">Tr·∫°ng th√°i:</label>
                <select id="orderStatus" [(ngModel)]="selectedStatus" class="form-control">
                  <option *ngFor="let status of orderStatuses" [value]="status.value">{{status.label}}</option>
                </select>
                <button class="btn btn-primary mt-2" (click)="UpdateStatus(order.Id)">C·∫≠p nh·∫≠t</button>
                <button class="btn btn-success mb-3" style="margin-top: 1.5rem; margin-left: 2rem;" (click)="exportToExcel()">üìÅ Xu·∫•t Excel</button>
              </div>
            </div>
          </div>
        </div>
    </div>   
</div>
